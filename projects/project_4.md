

# Project 4
<!--  https://gist.github.com/kantale/93df74b2b69890b57677e43158994a1a -->

## Μέρος 1
Ας υποθέσουμε ότι υπάρχει ένα mutation σε κάποια θέση του γονιδιώματος, το οποίο έχει δύο αλληλόμορφα: το A και το B.
Ας ορίσουμε ως pB τη πιθανότητα, να εμφανιστεί το αλληλόμορφο Β σε ένα σετ από τα 2 σετ χρωμοσωμάτων που έχει ο άνθρωπος. 
Τότε η πιθανότητα να έχει δύο B (ομόζυγος) είναι ```pB**2```. Επίσης η πιθανότητα να έχει ένα Α και ένα Β (ετερόζυγος) είναι ```(1-pB)*pB```.
Φτιάξτε μία συνάρτηση η οποία θα παίρνει δύο ορίσματα: το pB και το Ν. Η συνάρτηση θα επιστρέφει μία λίστα με τους γονότυπους από Ν "τυχαίους" ανθρώπους. Ο κάθε γονότυπος θα είναι είτε (Α,Α), είτε (Α,Β), είτε (Β,Β). Όπως είπαμε η πιθανότητα να "εμφανιστεί" ένα Β θα πρέπει να είναι pB. Η πιθανότητα να "εμφανιστεί" ένα Α είναι 1-pΒ. 

Η παρακάτω εντολή παράγει ένα τυχαίο δεκαδικό (float) αριθμό από το 0 μέχρι το 1.
```python
import random
random.random()
```

Η παρακάτω εντολή τυπώνει "κιθαρίστας" με πιθανότητα 80% και "ντράμερ" με πιθανότητα 20%.
```python
if random.random() < 0.8:
   print ('κιθαρίστας')
else:
   print ('ντράμερ')
```

**ΠΡΟΣΟΧΗ 1** Θεωρούμε ότι τα δύο χρωμοσώματα έχουν "ανεξάρτητες τιμές". Δηλαδή η πιθανότητα το ένα να είναι Β είναι ανεξάρτητη από τη πιθανότητα το άλλο να είναι Β. 

**ΠΡΟΣΟΧΗ 2** Κάποια βασικά: Το σύνολο όλου του γενετικού υλικού ενός οργανισμού ονομάζεται γονιδίωμα. Ο άνθρωπος έχει 2 σετ από [autosome](https://en.wikipedia.org/wiki/Autosome) χρωμοσώματα στο γονιδίωμά του. Το κάθε σετ έχει 22 χρωμοσώματα. Το ένα σετ το έχουμε πάρει από τον πατέρα μας και το άλλο από τη μητέρα μας. Θεωρούμε ότι η μετάλλαξη για την οποία μιλάει αυτή η άσκηση εμφανίζεται σε μία και μόνο μία θέση σε όλο το γωνιδίωμα. Δεν έχει σημασία σε ποιο χρωμόσωμα εμφανίζεται. Το θέμα είναι ότι η μετάλλαξη αυτή μπορεί είτε να υπάρχει, είτε να μην υπάρχει σε έναν άνθρωπο. Αν υπάρχει τότε μπορεί να εμφανιστεί με δύο τρόπους: ως ετερόζυγη (Α/Β), είτε ως ομόζυγη (Β/Β). Αν δεν υπάρχει τότε έχουμε Α/Α. Α/Β σημαίνει ότι το ένα σετ από χρωμοσώματσα δεν έχει τη μετάλλαξη, ενώ το άλλο την έχει (ή αλλιώς έχουμε πάρει τη μετάλλαξη ή από τον πατέρα μας ή από τη μητέρα μας). Β/Β σημαίνει ότι η μετάλλαξη υπάρχει και στα δύο σετ από χρωμοσώματα (ή αλλιώς την μετάλλαξη την έχουμε κληρονομήσει και από τον πατέρα μας και από τη μητέρα μας). Α/Α σημαίνει ότι ΔΕΝ έχουμε κληρονομήσει τη μετάλλαξη. 
Τα Α/Α, Α/Β και Β/Β ονομάζονται γονότυπος. Τα Α και Β ονομάζονται αλληλόμορφα. 

Ένας άλλος τρόπος να διατυπωθεί η άσκηση είναι:

Μία μπάλα μπορεί να είναι είτε άσπρη, είτε μαύρη. Η πιθανότητα να είναι μαύρη μία μπάλα είναι pB και η πιθανότητα να είναι άσπρη είναι 1-pB. Ένα κουτί έχει 2 μπάλες. Άρα ένα κουτί μπορεί να έχει είτε Άσπρη/Άσπρη, είτε Άσπρη/Μαύρη είτε Μαύρη/Μαύρη μπάλες. Η πιθανότητα η μία μπάλα να είναι μαύρη **είναι ανεξάρτητη** από τη πιθανότητητα η άλλη μπάλα να είναι μαύρη στο ίδιο κουτί. Φτιάξτε μία συνάρτηση που να παίρνει δύο παρπαμέτρους: pB και Ν. Η συνάρτηση επιστρέφει Ν κουτιά από ζευγάρια από μπάλες (ή αλλιώς μία λίστα μεγέθους Ν όπου το κάθε αντικείμενο της λίστας θα είναι ένα tuple με δύο strings). Η πιθανότητα κάθε μπάλα να είναι μαύρη είναι pB. 


## Μέρος 2ο
Συνεχίζουμε από το μέρος 1ο. Ας υποθέσουμε ότι αν ένας άνθρωπος έχει ένα (ή παραπάνω) 'B' τότε έχει αυξημένες πιθανότητες να έχει κάποια ασθένεια. Ορίζουμε τρεις πιθανότητες:
* pAA = Η πιθανότητα ένας άνθρωπος να έχει (A,A) και να έχει την ασθένεια
* pAB = Η πιθανότητα ένας άνθρωπος να έχει (Α,Β) και να έχει την ασθένεια 
* pBB = Η πιθανότητα ένας άνθρωπος να έχει (Β,Β) και να έχει την ασθένεια

ισχύει ότι: pΑΑ < pAB < pBB 

Φτιάξτε μία συνάρτηση η οποία θα παίρνει 5 παραμέτρους: το Ν, το pB, το pAA, το pAB και το pBB.
H συνάρτηση θα πρέπει να επιστρέφει μία λίστα με τον γονότυπο από Ν ανθρώπους (όπως ακριβώς στο 1ο μέρος) μαζί με το αν έχουν την ασθένεια ή όχι. Δηλαδη θα πρέπει να επιστρέφει μία λίστα της μορφής:

```python
a = [
   ('A', 'A', False), # είναι Α/Α και ΔΕΝ έχει την άσθένεια,
   ('A', 'B', True), # είναι A/B και Έχει την ασθένεια,
   ...
] 
```

Το αν έχουν την ασθένεια (ή όχι) καθορίζεται τυχαία, ανάλογα με τις παραμέτρους pAA, pAB, pBB. Δηλαδή παίρνουμε έναν άνθρωπο και ελέγχουμε τι γονότυπο έχει. Ας υποθέσουμε ότι έχει Α/Β. Άραγε έχει την ασθένεια; Για να το βρούμε αυτό παίρνουμε έναν **καινούργιο** τυχαίο αριθμό (```random.random()```) και ελέγχουμε αν αυτός ο αριθμός είναι μικρότερος από pAB. Αν είναι τότε αυτός ο άνθρωπος έχει την ασθένεια. Αν όχι τότε δεν έχει την ασθένεια. Ένα άλλο παράδειγμα: Παίρνουμε έναν άλλο άνθρωπο και ελέγχουμε τον γονότυπό του. Ας υποθέσουμε ότι είναι A/A, άραγε έχει την ασθένεια; Για να το βρούμε παίρνουμε έναν **άλλο και καινούργιο** τυχαίο αριθμό (```random.random()```) και κοιτάμε αν αυτός ο αριθμός είναι μικρότερος από το pAA. Αν είναι τότε ο άνθρωπος αυτός έχει την ασθένεια, αλλιώς δεν την έχει. 

**ΠΡΟΣΟΧΗ 1!** το pAB ΔΕΝ είναι η πιθανότητα να έχει γονότυπο Α/Β αλλά η πιθανότητα ΑΝ έχει γονότυπο Α/Β τότε να έχει την ασθένεια. 

Ένας άλλος τρόπος να το δούμε (με μπάλλες). Έχετε ένα κουτί με 100 ζευγάρια από μπάλες. Κάθε μπάλα του ζευγαριού μπορεί να είναι είτε άσπρη, είτε μαύρη. Η πιθανότητα μία μπάλα να είναι μαύρη είναι pB. Κάθε ζευγάρι μπορεί να είναι είτε Άσπρη/Άσπρη, είτε Άσπρη/Μαύρη, είτε Μαύρη/Μαύρη. Κάθε ζευγάρι μπορεί να είναι είτε Κινέζικης, είτε Ελληνικής κατασκευής. Οι πιθανότητες ένα ζευγάρι να είναι Ελληνικής κατασκευής εξαρτιώνται από το χρώμα τους. Η πιθανότητα ένα ζευγάρι να είναι Άσπρη/Άσπρη και να είναι Ελληνικής κατασκευής είναι pAA, η πιθανότητα ένα ζευγάρι να είναι Ελληνικής κατασκευής και να είναι Άσπρη/Μαύρη είναι pAB και η πιθανότητα ένα ζευγάρι να είναι Ελληνικής κατασκευής και να είναι Μαύρη/Μαύρη είναι pBB. 

## Μέρος 3ο
Συνεχίζουμε από το 2ο μέρος, και κάνουμε τώρα την εξής υπόθεση: Αν μετρήσουμε τον μέσο όρο των "Β" σε αυτούς που έχουν την ασθένεια και το μέσο όρο των "Β" σε αυτούς που ΔΕΝ έχουν την ασθένεια, θα πρέπει αυτοί που έχουν την ασθένεια να έχουν μεγαλύτερο μέσο όρο. Θα πρέπει να φτιάξετε μία συνάρτηση η οποία θα παίρνει ως παράμετρο τη λίστα που επιστρέφει η συνάρτηση του 2ου μέρους, και να επιστρέφει `True` ή `False` ανάλογα με το αν η παραπάνω υπόθεση είναι σωστή ή όχι.  

Για παράδειγμα έστω ότι οι "υγιείς" είναι ```healthy = ['AA', 'AA', 'AB']``` και οι "ασθενείς" είναι ```disease = ['AB', 'AA', 'BB']``` Τότε: Ο μέσος όρος των Β στους healthy είναι: 1/6 και ο μέσος όρος των Β στους disease είναι: 3/6. Αφού ```3/6>1/6``` τότε η συνάρτηση επιστρέφει `True`. Διαφορετικά επιστρέφει `False`.

## Μέρος 4ο
Τώρα μπορούμε να κάνουμε το εξής πείραμα: Αν έχουμε τις 5 παραμέτρους της συνάρτησης του 2ου μέρος, μπορούμε να δούμε με τη συνάρτηση του 2ου μέρους αν η υπόθεση του 3ου μέρους είναι σωστή. Φυσικά αυτό είναι μία μοναδική παρατήρηση. Θα ήταν ενδιαφέρον να επαναλάβουμε αυτή τη διαδικασία πολλές φορές και να μετρήσουμε το ποσοστό τους που η υπόθεση **ΔΕΝ** ήταν σωστή. Φτιάξτε μία συνάρτηση η οποία να παίρνει 6 ορίσματα: τα ορίσματα του 2ου μέρους και ένα όρισμα Τ το οποίο είναι πόσες φορές θέλουμε να επαναλάβουμε το πείραμα. Η συνάρτηση θα επιστρέφει έναν αριθμό από το 0 μέχρι 1 το οποίο θα είναι ο λόγος των Τ επαναλήψεων για τις οποίες η υπόθεση του 3ου μέρου είναι λάθος. 

**Αν έχετε φτάσεις μέχρι εδώ συγχαρητήρια μόλις υλοποιήσατε ένα [False Discovery Rate](https://en.wikipedia.org/wiki/False_discovery_rate), ή αλλιώς FDR**

## Μέρος 5ο
Τώρα, ήρθε η ώρα να απαντήσουμε σε ένα βιολογικό ερώτημα! Ας υποθέσουμε ότι οι πιθανότητες pAA, pAB και PBB είναι:
* pAA = 0.1
* pAB = 0.15
* pBB = 0.2

Η ερώτηση είναι: ποια πρέπει να είναι η μικρότερη τιμή της πιθανότητας pB, ώστε να μπορώ να επιβεβαιώσω τη συσχέτιση με την ασθένεια με FDR<0.05, σε έναν πληθυσμό με Ν=1000 και Τ=2000; Για να απαντήσουμε στην ερώτηση αυτή, τρέχτε τη συνάρτηση του 4ου μέρους για διάφορες τιμές του pB. Ξεκινήστε από 0.01 και αυξήστε το με βήμα 0.005. Για κάθε τιμή του pB υπολογίστες το FDR. Όταν το FDR πάρει τιμή κάτω από 0.05 σταματήστε και τυπώστε τη τιμή του pB που βρήκατε.  

Φτιάξτε μία συνάρτηση η οποία θα λύνει γενικότερα το παραπάνω πρόβλημα/ερώτηση. Η συνάρτηση θα παίρνει τις παραμέτρους: `N`, `T`, `pAA`, `pAB`, `pBB`, `FDR_max` και επιστρέφει το μικρότερη τιμή του pB ώστε να μπορεί να επιβεβαιωθεί η συσχέτιση με την ασθένεια με `FDR<FDR_max`. H παράμετρος `FDR_max` είναι προαιρετική, αν δεν τεθεί τότε θεωρούμε ότι `FDR_max=0.05`. Η συνάρτηση θα πρέπει να κάνει ό,τι και αυτό το βήμα. Δηλαδή ξεκινάει με pB=0.01, υπολογίζει το FDR και αν αυτό είναι μεγαλύτερο από `FDR_max` αυξάνει το pB με βήμα 0.005 και συνεχίζει. Όταν βρει `FDR<FDR_max` σταματάει και επιστέφει το pB που βρήκε.  

το ζητούμενο σε αυτό το project είναι ένα πρόγραμμα το οποίο θα παίρνει τις παρακάτω παραμέτρους από το command line:
```
--T <ΑΚΕΡΑΙΑ ΤΙΜΗ>, 
--pAA <ΔΕΚΑΔΙΚΗ ΤΙΜΗ>, 
--pAB <ΔΕΚΑΔΙΚΗ ΤΙΜΗ>
--pBB <ΔΕΚΑΔΙΚΗ ΤΙΜΗ>
--FDR <ΔΕΚΑΔΙΚΗ ΤΙΜΗ>   (προαιρετικό, αν δεν δοθεί, θεωρείτε ότι η τιμή του είναι 0.05)
--N <ΑΚΕΡΑΙΑ ΤΙΜH> <ΑΚΕΡΑΙΑ ΤΙΜH> <ΑΚΕΡΑΙΑ ΤΙΜH>
```

Στη συνέχεια θα φτιάχνει και θα σώζει σε ένα αρχείο ένα plot όπου στον X άξονα θα είναι οι τιμές του N από το Α μέχρι Β με συνολικό πλήθος από Γ βήματα, όπου Α,Β,Γ είναι οι τρεις ακέραιες τιμές της παραμέτρου N. Μπορείτε να χρησιμοποιήσετε τον παραπάνω κώδικα για αυτό:

```python
# Παράγει μία αριθμητική σειρά από το Α μέχρι το Β με Γ βήματα. 
# Το αποτέλεσμα είναι λίστα με ακέραιους.
import numpy as np
np.linspace(A, Β, num=Γ, dtype=int)
```

Στον Υ άξονα θα είναι η ελάχιστη τιμή του pB για το κάθε Ν τέτοιο ώστε το FDR να είναι μικρότερο από τη τιμή που δόθηκε στην αντίστοιχη παράμετρο (--FDR);  

**Σημείωση 1:** Οι παράμετροι αυτοί είναι υποχρεωτικοί (εκτός από το `--FDR`). Δηλαδή θα πρέπει να δηλώνονται πάντα από το command line. Παρόλο που το `--` σημαίνει προαιρετική παράμετρος, μπορείτε στην `argparse` να τη δηλώσεται σαν υποχρεωτική χρησιμοποιώντας τη παράμτετρο [required](https://docs.python.org/dev/library/argparse.html#required). Για παράδειγμα μπορειτε να πείτε:

```python
parser.add_argument('--T', help='Number of individuals', required=True)
```

** Σημείωση 2:** Η παράμετρος FDR στο command line είναι η παράμετρος FDR_max του μέρους 5. 


